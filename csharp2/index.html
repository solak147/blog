<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="keywords" content="中二病也要寫程式"><meta name="description" content="中二病也要寫程式"><meta property="og:title" content="中二病也要寫程式"><meta property="og:description" content="中二病也要寫程式"><meta name="twitter:title" content="中二病也要寫程式"><meta name="twitter:description" content="中二病也要寫程式"><base href="/Blog/"><link href="css/bootstrap/bootstrap.min.css" rel="stylesheet"><link href="css/app.css" rel="stylesheet"><link href="Blog.styles.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&amp;display=swap" rel="stylesheet"><link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet"><link rel="stylesheet" href="css/a11y-dark.min.css"><link rel="stylesheet" href="css/custom.css"><script src="https://partner.googleadservices.com/gampad/cookie.js?domain=localhost&amp;callback=_gfp_s_&amp;client=ca-pub-7750788533596067&amp;cookie=ID%3D3c6c206f6ed4843f-221fa9aab4db007c%3AT%3D1677935706%3ART%3D1677935706%3AS%3DALNI_MbFuM7tv0tF1iEsde52nCX2q0XJ7g&amp;gpic=UID%3D000009569caf6d14%3AT%3D1677935706%3ART%3D1677935706%3AS%3DALNI_MaG0GKO3hWPIL8iOIdbGW_--575Yg"></script><script src="https://pagead2.googlesyndication.com/pagead/managed/js/adsense/m202302230101/show_ads_impl.js?bust=31072649" id="google_shimpl"></script><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7750788533596067" crossorigin="anonymous" data-checked-head="true"></script><link rel="preconnect" href="https://fonts.googleapis.com"><meta http-equiv="origin-trial" content="Az6AfRvI8mo7yiW5fLfj04W21t0ig6aMsGYpIqMTaX60H+b0DkO1uDr+7BrzMcimWzv/X7SXR8jI+uvbV0IJlwYAAACFeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjgwNjUyNzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A+USTya+tNvDPaxUgJooz+LaVk5hPoAxpLvSxjogX4Mk8awCTQ9iop6zJ9d5ldgU7WmHqBlnQB41LHHRFxoaBwoAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjgwNjUyNzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A7FovoGr67TUBYbnY+Z0IKoJbbmRmB8fCyirUGHavNDtD91CiGyHHSA2hDG9r9T3NjUKFi6egL3RbgTwhhcVDwUAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjgwNjUyNzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><link rel="preconnect" href="https://pagead2.googlesyndication.com"><link rel="preconnect" href="https://googleads.g.doubleclick.net"><link rel="preload" href="https://adservice.google.com/adsid/integrator.js?domain=localhost" as="script"><script type="text/javascript" src="https://adservice.google.com/adsid/integrator.js?domain=localhost"></script><link rel="preconnect" href="https://adservice.google.com"><link rel="preconnect" href="https://partner.googleadservices.com"><link rel="preconnect" href="https://tpc.googlesyndication.com"><link rel="preconnect" href="https://www.google.com"><!--!--><title>中二病也要寫程式</title><!--!--><!--!--></head><body style="background-color:#2b2c30"><div id="app" style="width:100vw;height:100vh"><!--!--><!--!--><!--!--><!--!--><div class="page" b-p6zcnqvy2k=""><div class="sidebar" style="background-image:url(images/nav.jpg);background-repeat:no-repeat;background-size:cover" b-p6zcnqvy2k=""><!--!--><!--!--><div class="top-row ps-3 navbar navbar-dark" b-wtm1afifms=""><div class="container-fluid" b-wtm1afifms=""><a class="navbar-brand" href="" b-wtm1afifms="">中二病也要寫程式</a></div></div><!--!--><div class="mud-navmenu mud-navmenu-default mud-navmenu-margin-none navlist" style="color:#fff;overflow-y:auto;height:95%"><!--!--><div class="mud-nav-group"><button tabindex="0" class="mud-nav-link mud-ripple mud-expanded"><!--!--><svg class="mud-icon-root mud-icon-default mud-svg-icon mud-icon-size-medium mud-nav-link-icon mud-nav-link-icon-default" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"></path></svg><div class="mud-nav-link-text">C#</div><!--!--><svg class="mud-icon-root mud-svg-icon mud-icon-size-medium mud-nav-link-expand-icon mud-transform" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M7 10l5 5 5-5z"></path></svg></button><!--!--><!--!--><div class="mud-collapse-container mud-collapse-entered mud-navgroup-collapse" style="height:auto" _bl_2=""><div class="mud-collapse-wrapper" _bl_3=""><div class="mud-collapse-wrapper-inner"><!--!--><div class="mud-navmenu mud-navmenu-default mud-navmenu-margin-none"><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./csharp1" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->C#基礎 - new vs overrvide</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./csharp2" rel="" class="mud-nav-link active"><div class="mud-nav-link-text"><!--!-->ASP.NET Web API 訊息處理器</div></a></div><!--!--><!--!--><div class="mud-nav-group"><button tabindex="0" class="mud-nav-link mud-ripple"><!--!--><svg class="mud-icon-root mud-icon-default mud-svg-icon mud-icon-size-medium mud-nav-link-icon mud-nav-link-icon-default" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"></path></svg><div class="mud-nav-link-text">Blazor</div><!--!--><svg class="mud-icon-root mud-svg-icon mud-icon-size-medium mud-nav-link-expand-icon" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M7 10l5 5 5-5z"></path></svg></button><!--!--><!--!--><div class="mud-collapse-container mud-navgroup-collapse" style="" _bl_12=""><div class="mud-collapse-wrapper" _bl_13=""><div class="mud-collapse-wrapper-inner"><!--!--><div class="mud-navmenu mud-navmenu-default mud-navmenu-margin-none"><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./blazor1" rel="" class="mud-nav-link"><div class="mud-nav-link-text">StateHasChanged() vs InvokeAsync(StateHasChanged)</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./blazor2" rel="" class="mud-nav-link"><div class="mud-nav-link-text">Service Lifetime</div></a></div></div></div></div></div></div></div></div></div></div></div><!--!--><!--!--><div class="mud-nav-group"><button tabindex="0" class="mud-nav-link mud-ripple mud-expanded"><!--!--><svg class="mud-icon-root mud-icon-default mud-svg-icon mud-icon-size-medium mud-nav-link-icon mud-nav-link-icon-default" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"></path></svg><div class="mud-nav-link-text">JavaScript</div><!--!--><svg class="mud-icon-root mud-svg-icon mud-icon-size-medium mud-nav-link-expand-icon mud-transform" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M7 10l5 5 5-5z"></path></svg></button><!--!--><!--!--><div class="mud-collapse-container mud-collapse-entered mud-navgroup-collapse" style="height:auto" _bl_4=""><div class="mud-collapse-wrapper" _bl_5=""><div class="mud-collapse-wrapper-inner"><!--!--><div class="mud-navmenu mud-navmenu-default mud-navmenu-margin-none"><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./javascript1" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->Promise 簡介</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./javascript2" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->使用 Promise 達到同步等待js資源載入</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./javascript3" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->傳統函式 VS 箭頭函式</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./javascript4" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->Cookie、LocalStorage、SessionStorage 差異</div></a></div><!--!--><!--!--><div class="mud-nav-group"><button tabindex="0" class="mud-nav-link mud-ripple"><!--!--><svg class="mud-icon-root mud-icon-default mud-svg-icon mud-icon-size-medium mud-nav-link-icon mud-nav-link-icon-default" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"></path></svg><div class="mud-nav-link-text">Vue</div><!--!--><svg class="mud-icon-root mud-svg-icon mud-icon-size-medium mud-nav-link-expand-icon" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M7 10l5 5 5-5z"></path></svg></button><!--!--><!--!--><div class="mud-collapse-container mud-navgroup-collapse" style="" _bl_14=""><div class="mud-collapse-wrapper" _bl_15=""><div class="mud-collapse-wrapper-inner"><!--!--><div class="mud-navmenu mud-navmenu-default mud-navmenu-margin-none"><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./vue1" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->Vue 生命週期</div></a></div></div></div></div></div></div><!--!--><!--!--><div class="mud-nav-group"><button tabindex="0" class="mud-nav-link mud-ripple"><!--!--><svg class="mud-icon-root mud-icon-default mud-svg-icon mud-icon-size-medium mud-nav-link-icon mud-nav-link-icon-default" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"></path></svg><div class="mud-nav-link-text">Nuxt</div><!--!--><svg class="mud-icon-root mud-svg-icon mud-icon-size-medium mud-nav-link-expand-icon" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M7 10l5 5 5-5z"></path></svg></button><!--!--><!--!--><div class="mud-collapse-container mud-navgroup-collapse" style="" _bl_16=""><div class="mud-collapse-wrapper" _bl_17=""><div class="mud-collapse-wrapper-inner"><!--!--><div class="mud-navmenu mud-navmenu-default mud-navmenu-margin-none"><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./nuxt1" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->Nuxt 生命週期</div></a></div></div></div></div></div></div></div></div></div></div></div><!--!--><!--!--><div class="mud-nav-group"><button tabindex="0" class="mud-nav-link mud-ripple mud-expanded"><!--!--><svg class="mud-icon-root mud-icon-default mud-svg-icon mud-icon-size-medium mud-nav-link-icon mud-nav-link-icon-default" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"></path></svg><div class="mud-nav-link-text">Css</div><!--!--><svg class="mud-icon-root mud-svg-icon mud-icon-size-medium mud-nav-link-expand-icon mud-transform" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M7 10l5 5 5-5z"></path></svg></button><!--!--><!--!--><div class="mud-collapse-container mud-collapse-entered mud-navgroup-collapse" style="height:auto" _bl_6=""><div class="mud-collapse-wrapper" _bl_7=""><div class="mud-collapse-wrapper-inner"><!--!--><div class="mud-navmenu mud-navmenu-default mud-navmenu-margin-none"><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./css1" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->EM 與 REM 的差異</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./css2" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->VH、VW、VMIN、VMAX</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./css3" rel="" class="mud-nav-link"><div class="mud-nav-link-text">Display Flex</div></a></div></div></div></div></div></div><!--!--><!--!--><div class="mud-nav-group"><button tabindex="0" class="mud-nav-link mud-ripple mud-expanded"><!--!--><svg class="mud-icon-root mud-icon-default mud-svg-icon mud-icon-size-medium mud-nav-link-icon mud-nav-link-icon-default" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"></path></svg><div class="mud-nav-link-text">Dart</div><!--!--><svg class="mud-icon-root mud-svg-icon mud-icon-size-medium mud-nav-link-expand-icon mud-transform" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M7 10l5 5 5-5z"></path></svg></button><!--!--><!--!--><div class="mud-collapse-container mud-collapse-entered mud-navgroup-collapse" style="height:auto" _bl_8=""><div class="mud-collapse-wrapper" _bl_9=""><div class="mud-collapse-wrapper-inner"><!--!--><div class="mud-navmenu mud-navmenu-default mud-navmenu-margin-none"><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./dart1" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->Dart基礎 - 初入dart</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./dart2" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->Dart基礎 - @immutable</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./dart3" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->Dart基礎 - 建構式</div></a></div><!--!--><!--!--><div class="mud-nav-group"><button tabindex="0" class="mud-nav-link mud-ripple"><!--!--><svg class="mud-icon-root mud-icon-default mud-svg-icon mud-icon-size-medium mud-nav-link-icon mud-nav-link-icon-default" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"></path></svg><div class="mud-nav-link-text">Flutter</div><!--!--><svg class="mud-icon-root mud-svg-icon mud-icon-size-medium mud-nav-link-expand-icon" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M7 10l5 5 5-5z"></path></svg></button><!--!--><!--!--><div class="mud-collapse-container mud-navgroup-collapse" style="" _bl_18=""><div class="mud-collapse-wrapper" _bl_19=""><div class="mud-collapse-wrapper-inner"><!--!--><div class="mud-navmenu mud-navmenu-default mud-navmenu-margin-none"><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./flutter1" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->編譯錯誤 : missing an input or output annotation</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./flutter2" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->什麼是 Bloc Design Pattern</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./flutter3" rel="" class="mud-nav-link"><div class="mud-nav-link-text">MaterialApp</div></a></div></div></div></div></div></div></div></div></div></div></div><!--!--><!--!--><div class="mud-nav-group"><button tabindex="0" class="mud-nav-link mud-ripple mud-expanded"><!--!--><svg class="mud-icon-root mud-icon-default mud-svg-icon mud-icon-size-medium mud-nav-link-icon mud-nav-link-icon-default" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"></path></svg><div class="mud-nav-link-text">Web Deploy</div><!--!--><svg class="mud-icon-root mud-svg-icon mud-icon-size-medium mud-nav-link-expand-icon mud-transform" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><!--!--><path d="M0 0h24v24H0z" fill="none"></path><path d="M7 10l5 5 5-5z"></path></svg></button><!--!--><!--!--><div class="mud-collapse-container mud-collapse-entered mud-navgroup-collapse" style="height:auto" _bl_10=""><div class="mud-collapse-wrapper" _bl_11=""><div class="mud-collapse-wrapper-inner"><!--!--><div class="mud-navmenu mud-navmenu-default mud-navmenu-margin-none"><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./githubpage" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->Blazor WebAssembly 使用 Github Pages 進行部屬</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./gcpvm" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->Google Cloud Platform 創建虛擬主機 (VM) 來架設網站</div></a></div><!--!--><!--!--><div class="mud-nav-item mud-ripple"><!--!--><a href="./gcpdocker" rel="" class="mud-nav-link"><div class="mud-nav-link-text"><!--!-->使用 Docker 建立 MySQL</div></a></div></div></div></div></div></div></div></div><!--!--><main b-p6zcnqvy2k=""><article class="content px-4" b-p6zcnqvy2k=""><div b-p6zcnqvy2k=""><!--!--><!--!--><div class="article"><h2><b>ASP.NET Web API 訊息處理器</b></h2><p>ASP.NET Web API 是以 HttpRequestMessage 類別來代表用戶端發出的 HTTP 請求，並以 HttpResponseMessage 類別來代表伺服器端的回應結果。 也就是說，ASP.NET Web API 從收到用戶端請求開始到產生回應結果的過程當中，會在某個適當時間分別建立 HttpRequestMessage 和 HttpResponseMessage 物件實體。 這個收到請求、處理請求、至產生回應的過程，一般稱為管線（pipeline）。<br><br>稱為管線，因為 HTTP 請求就像水一般從第一條水管流入，行經數個相互銜接的水管，直到最後一個；處理完請求並產生回應之後，接著又讓回應結果循原路回去，流經先前的各條水管。 在這個過程當中，我們也可以安插自己的水管，在裡面動點手腳。<br><br>這一截截的「水管」對應到 Web API 的實作，就是訊息處理器（message handler）了。下圖概略描繪了 ASP.NET Web API 的「請求－回應」管線：</p><img src="images/csharp_1.png" alt="csharp_1" class="imgfmt" style="width:50%"><p>圖中的 HttpServer 類別隸屬 System.Web.Http 命名空間，其父類別是 DelegatingHandler，祖父則是抽象類別 HttpMessageHandler。 也就是說，HttpSever 本身就是個訊息處理器。根據 MSDN 網站的說明，其責任是分派 HttpRequestMessage，以及建立 HttpResponseMessage。</p><h3><b>DelegatingHandler</b></h3><p>DelegatingHandler 的用途是處理 HttpRequestMessage 和 HttpResponseMessage 物件，並將處理過的物件交給下一棒繼續處理（於是形成了前面提過的管線機制）。 當然，在處理的時候，也可以不要傳遞給下一個處理器，亦即停止後續的管線。<br><br>DelegatingHandler 有個 InnerHandler 屬性，型別是 HttpMessageHandler（它就是 DelegatingHandler 的父類別）。 這個 InnerHandler 會指向下一條管線──這裡稍微改個說法：InnerHandler 會指向下一層管線。</p><h3><b>實作 DelegatingHandler</b></h3><pre><code class="CSharp hljs language-CSharp">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyRequestHandler</span> : <span class="hljs-title">DelegatingHandler</span>
        {
            <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">async</span> Task&lt;HttpResponseMessage&gt; <span class="hljs-title">SendAsync</span>(<span class="hljs-params">HttpRequestMessage request, CancellationToken cancellationToken</span>)</span>
            {
                <span class="hljs-comment">//收到response前做的事</span>

                <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">await</span> <span class="hljs-keyword">base</span>.SendAsync(request, cancellationToken);

                <span class="hljs-comment">//收到response後做的事</span>
                <span class="hljs-keyword">switch</span> (response.StatusCode)
                {
                <span class="hljs-keyword">case</span> HttpStatusCode.Unauthorized:
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> (HttpStatusCode)<span class="hljs-number">440</span>:
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> HttpStatusCode.Forbidden:
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> HttpStatusCode.ServiceUnavailable:
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
    </code></pre><h3><b>在Program.cs註冊訊息處理器</b></h3><pre><code class="CSharp hljs language-CSharp">
        builder.Services.AddHttpMessageHandler&lt;MyRequestHandler&gt;();
    </code></pre></div></div></article></main></div><!--!--><!--!--></div><div id="blazor-error-ui">An unhandled error has occurred. <a href="" class="reload">Reload</a> <a class="dismiss">🗙</a></div><script src="_framework/blazor.webassembly.js"></script><ins class="adsbygoogle adsbygoogle-noablate" data-adsbygoogle-status="done" style="display:none!important" data-ad-status="unfilled"><div id="aswift_0_host" tabindex="0" title="Advertisement" aria-label="Advertisement" style="border:none;height:0;width:0;margin:0;padding:0;position:relative;visibility:visible;background-color:transparent;display:inline-block"><iframe id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;border:0;width:undefinedpx;height:undefinedpx" sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-7750788533596067&amp;output=html&amp;adk=1812271804&amp;adf=3025194257&amp;lmt=1677935705&amp;plat=3%3A65536%2C4%3A65536%2C9%3A32768%2C16%3A8388608%2C17%3A32%2C24%3A32%2C25%3A32%2C30%3A1048576%2C32%3A32%2C41%3A32%2C42%3A32&amp;format=0x0&amp;url=http%3A%2F%2Flocalhost%3A45678%2Fcsharp2&amp;ea=0&amp;pra=5&amp;wgl=1&amp;dt=1677935709643&amp;bpp=37&amp;bdt=103&amp;idt=320&amp;shv=r20230301&amp;mjsv=m202302230101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D3c6c206f6ed4843f-221fa9aab4db007c%3AT%3D1677935706%3ART%3D1677935706%3AS%3DALNI_MbFuM7tv0tF1iEsde52nCX2q0XJ7g&amp;gpic=UID%3D000009569caf6d14%3AT%3D1677935706%3ART%3D1677935706%3AS%3DALNI_MaG0GKO3hWPIL8iOIdbGW_--575Yg&amp;nras=1&amp;correlator=371505705540&amp;frm=20&amp;pv=2&amp;ga_vid=217291091.1677935710&amp;ga_sid=1677935710&amp;ga_hid=777081941&amp;ga_fc=0&amp;u_tz=0&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=-12245933&amp;ady=-12245933&amp;biw=480&amp;bih=850&amp;scr_x=0&amp;scr_y=0&amp;eid=44773810%2C44777876%2C44759926%2C44759875%2C44759837%2C31071756%2C31072649%2C31072731&amp;oid=2&amp;pvsid=1131345990550008&amp;tmod=1579620034&amp;uas=3&amp;nvt=1&amp;fc=1920&amp;brdim=0%2C0%2C0%2C0%2C800%2C0%2C800%2C600%2C480%2C850&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=33792&amp;bc=31&amp;ifi=1&amp;uci=a!1&amp;fsb=1&amp;dtd=387" data-google-container-id="a!1" data-load-complete="true"></iframe></div></ins><script src="_content/MudBlazor/MudBlazor.min.js"></script><script src="js/highlight.min.js"></script><script src="js/javascript.js"></script><iframe src="https://www.google.com/recaptcha/api2/aframe" width="0" height="0" style="display:none"></iframe></body><iframe id="google_esf" name="google_esf" src="https://googleads.g.doubleclick.net/pagead/html/r20230301/r20190131/zrt_lookup.html" style="display:none"></iframe></html>